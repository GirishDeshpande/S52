<!DOCTYPE html>

<html>
  <noscript>s52ui need JavaScript</noscript>

  <head>
    <title>s52ui</title>

    <meta charset="utf-8">

    <link rel="stylesheet" type="text/css" href="s52ui.css" />

    <!-- initial UI layout -->
    <script type="text/javascript" src="js/tinyjet-0.1.js">  </script>
    <script type="text/javascript" src="s52ui.js">           </script>

    <!-- WebSocket Implementation for Android Browser       -->
    <!-- via Cordova plugin infrastructure                  -->

    <!-- BUG CHROME: it choke here when run on laptop (dart2js OK - firefox)
        // cordova define "menubutton"
    <script type="text/javascript" src="js/cordova.js">       </script>
    <script type="text/javascript" src="js/cordova-2.2.0.js"> </script>
    -->
    <script type="text/javascript" src="js/cordova.js">       </script>
    <script type="text/javascript" src="js/websocket.js">     </script>

    <!-- dart code -->
    <script type="application/dart" src="s52ui.dart">                  </script>
    <script type="text/javascript"  src="packages/browser/dart.js">    </script>
    <script type="text/javascript"  src="packages/browser/interop.js"> </script>

  </head>

  <body id="mainBody">
    <script type="text/javascript">
        //* onkeypress="toggleUI();"
    	// set geolocation options here because Dart geolocation options 
    	// seem broken as of 2013OCT13 latest build (28108)
    	document.addEventListener("deviceready", getCurrentPosition, false);
      	function getCurrentPosition() {
      		document.addEventListener("backbutton", toggleUI, false);
      		//document.addEventListener("keypress", toggleUI, false);
        	console.log("XXXXX getCurrentPosition(): - start -");
        	navigator.geolocation.getCurrentPosition(showPosition, geoError, {maximumAge:60000, timeout:5000, enableHighAccuracy:true});
        	console.log("XXXXX getCurrentPosition(): - end -");
    	}
      	function showPosition(position) {
  			var latlon = "ZZZZZ showPosition(): " + position.coords.latitude + "," + position.coords.longitude;
  			console.log(latlon);
	  	}
      	function geoError(error) {
      	  	console.log('EEEEE geoError(): code: '    + error.code    + ', ' + 'message: ' + error.message + '\n');
        }
      	
        //*/
        // WebSocket <--> libS52
      	// FIXME: can Dart handle directly Cordova websocket on Android ?

      	//var wsUri = 'ws://192.168.1.66:2950'; // laptop
      	//var wsUri = 'ws://192.168.1.67:2950'; // xoom
      	var wsUri = 'ws://127.0.0.1:2950';   // localhost

      	var websocket;
      	window.onload = function initWebSocket() {
      		console.log("initWebSocket() - start - ");
        	websocket = new WebSocket(wsUri);
        	websocket.onclose   = function(evt) { onClose(evt)   };
        	websocket.onerror   = function(evt) { onError(evt)   };
        	websocket.onopen    = function(evt) { onOpen(evt)    };
      	}

      	function onOpen (evt)   {}
      	function onClose(evt)   { console.log("s52ui.html:Websock:onClose():" + evt + "<<<"); }
      	function onError(evt)   { console.log("s52ui.html:Websock:onError():" + evt + "<<<"); }

      	function toggleUI(evt)  {}
    </script>
  
    <p id="__beg_mainWindowComponent" hidden="true">id_beg</p>
    <p id="__end_mainWindowComponent" hidden="true">id_end</p>

  </body>

</html>


<!--
<script>
txt = "<p>Browser CodeName:    " + window.navigator.appCodeName    + "</p>";
txt+= "<p>Browser Name:        " + window.navigator.appName        + "</p>";
txt+= "<p>Browser Version:     " + window.navigator.appVersion     + "</p>";
txt+= "<p>Cookies Enabled:     " + window.navigator.cookieEnabled  + "</p>";
txt+= "<p>Platform:            " + window.navigator.platform       + "</p>";
txt+= "<p>User-agent header:   " + window.navigator.userAgent      + "</p>";
txt+= "<p>User-agent language: " + window.navigator.systemLanguage + "</p>";

window.document.getElementById("example").innerHTML=txt;
</script>
-->


